{"version":3,"sources":["../src/index.test.js"],"names":["Index","proxyquire","noCallThru","load","sleep","time","Promise","resolve","setTimeout","createDeferredStub","observable","sinon","stub","returns","subscribe","handler","test","afterEach","always","restore","t","plan","id","result","instanceStub","rpc","sendAndObserveResponse","AppProxyHandler","get","value","is","true","calledOnceWith","networkDetails","type","networkFn","AppProxy","prototype","network","jsonrpc","sendAndObserveResponses","call","deepEqual","truthy","accountsFn","accounts","currentApp","appAddress","appId","appImplementationAddress","identifier","isForwarder","kernelAddress","name","currentAppFn","icon","initialApps","endApps","concat","installedAppsFn","installedApps","emitIndex","forEach","app","fail","identifyFn","identify","send","pathFn","path","requestPathFn","requestPath","eventData","testprop","emitTriggerFn","emitTrigger","triggersFn","triggers","eventsFn","events","externalFn","external","observableEvents","jsonInterfaceStub","eventsObservable","fromBlock","observableCall","constant","callResult","grantPermission","observableIntent","intentResult","add","stateFn","state","stateObservable","Subject","counter","next","storeFn","store","cache","getCache","pastEvents","web3Eth","withArgs","action","actionHistory","event","push","payload","blockNumber","callFn","describeScriptFn","describeScript","web3EthFn"],"mappings":"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","sourcesContent":["import test from 'ava'\nimport sinon from 'sinon'\nimport proxyquire from 'proxyquire'\nimport { defer, from, of, Subject } from 'rxjs'\n\nconst Index = proxyquire.noCallThru().load('./index', {\n  '@aragon/rpc-messenger': {}\n})\n\nasync function sleep (time) {\n  return new Promise(resolve => setTimeout(resolve, time))\n}\n\nfunction createDeferredStub (observable) {\n  return sinon.stub().returns(defer(() => observable))\n}\n\nfunction subscribe (observable, handler) {\n  // Mimic an async delay to test the deferred behaviour\n  sleep(10)\n  observable.subscribe(handler)\n}\n\ntest.afterEach.always(() => {\n  sinon.restore()\n})\n\ntest('should send intent when the method does not exist in target', t => {\n  t.plan(2)\n  // arrange\n  const observable = of({\n    id: 'uuid1',\n    result: 10\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = Index.AppProxyHandler.get(instanceStub, 'add')(5)\n  // assert\n  subscribe(result, value => {\n    t.is(value, 10)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('intent', ['add', 5]))\n})\n\ntest('should return the network details as an observable', t => {\n  t.plan(2)\n  // arrange\n  const networkDetails = {\n    id: 4,\n    type: 'rinkeby'\n  }\n  const networkFn = Index.AppProxy.prototype.network\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: networkDetails\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = networkFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, networkDetails)\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('network'))\n})\n\ntest('should return the accounts as an observable', t => {\n  t.plan(2)\n  // arrange\n  const accountsFn = Index.AppProxy.prototype.accounts\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: ['accountX', 'accountY', 'accountZ']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = accountsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountX', 'accountY', 'accountZ'])\n  })\n  t.truthy(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('accounts'))\n})\n\ntest('should send a getApps request for the current app and observe the single response', t => {\n  t.plan(3)\n\n  const currentApp = {\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter'\n  }\n\n  // arrange\n  const currentAppFn = Index.AppProxy.prototype.currentApp\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: currentApp\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = currentAppFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.is(value.icon(), undefined)\n    delete value.icon\n\n    t.deepEqual(value, currentApp)\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('get_apps'))\n})\n\ntest('should send a getApps request for installed apps and observe the response', t => {\n  const initialApps = [{\n    appAddress: '0x123',\n    appId: 'kernel',\n    appImplementationAddress: '0xkernel',\n    identifier: undefined,\n    isForwarder: false,\n    kernelAddress: undefined,\n    name: 'Kernel'\n  }]\n  const endApps = [].concat(initialApps, {\n    appAddress: '0x456',\n    appId: 'counterApp',\n    appImplementationAddress: '0xcounterApp',\n    identifier: 'counter',\n    isForwarder: false,\n    kernelAddress: '0x123',\n    name: 'Counter'\n  })\n\n  // arrange\n  const installedAppsFn = Index.AppProxy.prototype.installedApps\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: initialApps\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: endApps\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = installedAppsFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    value.forEach(app => {\n      t.is(app.icon(), undefined)\n      delete app.icon\n    })\n\n    if (emitIndex === 0) {\n      t.deepEqual(value, initialApps)\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, endApps)\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('get_apps'))\n})\n\ntest('should send an identify request', t => {\n  t.plan(1)\n  // arrange\n  const identifyFn = Index.AppProxy.prototype.identify\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  identifyFn.call(instanceStub, 'ANT')\n  // assert\n  t.true(instanceStub.rpc.send.calledOnceWith('identify', ['ANT']))\n})\n\ntest('should send a path request and observe the response', t => {\n  t.plan(3)\n  // arrange\n  const pathFn = Index.AppProxy.prototype.path\n  const observable = of(\n    {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path1'\n    }, {\n      jsonrpc: '2.0',\n      id: 'uuid1',\n      result: 'path2'\n    }\n  )\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = pathFn.call(instanceStub)\n  // assert\n  let emitIndex = 0\n  subscribe(result, value => {\n    if (emitIndex === 0) {\n      t.deepEqual(value, 'path1')\n    } else if (emitIndex === 1) {\n      t.deepEqual(value, 'path2')\n    } else {\n      t.fail('too many emissions')\n    }\n\n    emitIndex++\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('path', ['observe']))\n})\n\ntest('should send a path modification request', t => {\n  t.plan(2)\n  // arrange\n  const path = 'new_path'\n  const requestPathFn = Index.AppProxy.prototype.requestPath\n  const observable = of({\n    jsonrpc: '2.0',\n    id: 'uuid1',\n    result: null\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = requestPathFn.call(instanceStub, path)\n  // assert\n  subscribe(result, value => t.is(value, null))\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('path', ['modify', path]))\n})\n\ntest('should send a trigger emission', t => {\n  t.plan(1)\n  // arrange\n  const eventName = 'TestTrigger'\n  const eventData = { testprop: '123abc' }\n  const emitTriggerFn = Index.AppProxy.prototype.emitTrigger\n  const instanceStub = {\n    rpc: {\n      send: sinon.stub()\n    }\n  }\n  // act\n  emitTriggerFn.call(instanceStub, eventName, eventData)\n  // assert\n  t.true(instanceStub.rpc.send.calledOnceWith('trigger', ['emit', eventName, eventData]))\n})\n\ntest('should return the triggers observable', t => {\n  t.plan(2)\n  // arrange\n  const triggersFn = Index.AppProxy.prototype.triggers\n  // TODO\n  const observable = of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = triggersFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    // TODO\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('trigger', ['observe']))\n})\n\ntest('should return the events observable', t => {\n  t.plan(2)\n  // arrange\n  const eventsFn = Index.AppProxy.prototype.events\n  const observable = of({\n    id: 'uuid1',\n    result: ['eventA', 'eventB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = eventsFn.call(instanceStub)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['eventA', 'eventB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('events', ['allEvents', {}]))\n})\n\ntest('should return an handle for an external contract events', t => {\n  t.plan(2)\n  const fromBlock = 2\n\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableEvents = of({\n    id: 'uuid1',\n    result: { name: 'eventA', value: 3000 }\n  })\n  const jsonInterfaceStub = [\n    { type: 'event', name: 'SetPermission' }\n  ]\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(observableEvents)\n    }\n  }\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  // events from starting block\n  const eventsObservable = result.events({ fromBlock })\n  // assert\n  subscribe(eventsObservable, value => {\n    t.deepEqual(value, { name: 'eventA', value: 3000 })\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponses.calledOnceWith(\n      'external_events',\n      ['0xextContract', [jsonInterfaceStub[0]], 'allEvents', { fromBlock }]\n    )\n  )\n})\n\ntest('should return a handle for creating external calls', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableCall = of({\n    id: 'uuid4',\n    result: 'bob was granted permission for the counter app'\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'grantPermission', constant: true }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableCall)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const callResult = result.grantPermission('0xbob', '0xcounter')\n\n  // assert\n  subscribe(callResult, value => {\n    t.is(value, 'bob was granted permission for the counter app')\n  })\n\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_call',\n      ['0xextContract', jsonInterfaceStub[0], '0xbob', '0xcounter']\n    )\n  )\n})\n\ntest('should return a handle for creating external transaction intents', t => {\n  t.plan(2)\n  // arrange\n  const externalFn = Index.AppProxy.prototype.external\n  const observableIntent = of({\n    id: 'uuid4',\n    result: 10\n  })\n\n  const jsonInterfaceStub = [\n    { type: 'function', name: 'add', constant: false }\n  ]\n\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observableIntent)\n    }\n  }\n\n  // act\n  const result = externalFn.call(instanceStub, '0xextContract', jsonInterfaceStub)\n  const intentResult = result.add(10)\n\n  // assert\n  subscribe(intentResult, value => {\n    t.is(value, 10)\n  })\n  t.true(\n    instanceStub.rpc.sendAndObserveResponse.calledOnceWith(\n      'external_intent',\n      ['0xextContract', jsonInterfaceStub[0], 10]\n    )\n  )\n})\n\ntest('should return the state from cache', t => {\n  t.plan(3)\n  // arrange\n  const stateFn = Index.AppProxy.prototype.state\n  const stateObservable = new Subject()\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponses: createDeferredStub(stateObservable)\n    }\n  }\n  // act\n  const result = stateFn.call(instanceStub)\n  // assert\n  t.true(instanceStub.rpc.sendAndObserveResponses.calledOnceWith('cache', ['observe', 'state']))\n\n  let counter = 0\n  subscribe(result, value => {\n    if (counter === 0) {\n      t.deepEqual(value, { counter: 5 })\n    } else if (counter === 1) {\n      t.deepEqual(value, { counter: 6 })\n    }\n    counter++\n  })\n  // send state events\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 5 }\n  })\n  stateObservable.next({\n    id: 'uuid1',\n    result: { counter: 6 }\n  })\n})\n\ntest('should create a store and reduce correctly without previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => from([null]),\n    pastEvents: () => of([]),\n    triggers: () => of(),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 2) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 12) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(1200)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(1200)\n})\n\ntest('should create a store and reduce correctly with previously cached state', async t => {\n  t.plan(2)\n  // arrange\n  const storeFn = Index.AppProxy.prototype.store\n  const observableEvents = new Subject()\n\n  const instanceStub = {\n    accounts: () => from([\n      ['0x0000000000000000000000000000000000000abc']\n    ]),\n    cache: () => of(),\n    events: createDeferredStub(observableEvents),\n    getCache: () => of({\n      state: {\n        actionHistory: [\n          { event: 'Add', payload: 5 }\n        ],\n        counter: 5\n      },\n      blockNumber: 1\n    }),\n    pastEvents: () => of([]),\n    triggers: () => of(),\n    web3Eth: sinon.stub().withArgs('getBlockNumber').returns(from(['4385398']))\n  }\n  const reducer = (state, action) => {\n    if (state === null) state = { actionHistory: [], counter: 0 }\n\n    switch (action.event) {\n      case 'Add':\n        state.actionHistory.push(action)\n        state.counter += action.payload\n        return state\n      case 'Subtract':\n        state.actionHistory.push(action)\n        state.counter -= action.payload\n        return state\n    }\n    return state\n  }\n  // act\n  const result = storeFn.call(instanceStub, reducer)\n  // assert\n  subscribe(result, value => {\n    if (value.counter === 5) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 }\n      ])\n    }\n    if (value.counter === 7) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 }\n      ])\n    }\n    if (value.counter === 17) {\n      t.deepEqual(value.actionHistory, [\n        { event: 'Add', payload: 5 },\n        { event: 'Add', payload: 2 },\n        { event: 'Add', payload: 10 }\n      ])\n    }\n  })\n  // send events; wait to avoid grouping through debounce\n  await sleep(250)\n  observableEvents.next({ event: 'Add', payload: 2 })\n  await sleep(1200)\n  observableEvents.next({ event: 'Add', payload: 10 })\n  await sleep(1200)\n})\n\ntest('should perform a call to the contract and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const callFn = Index.AppProxy.prototype.call\n  const observable = of({\n    id: 'uuid1',\n    result: 'success'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = callFn.call(instanceStub, 'transferEth', 10)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'success')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('call', ['transferEth', 10]))\n})\n\ntest('should send a describeScript request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const describeScriptFn = Index.AppProxy.prototype.describeScript\n  const observable = of({\n    id: 'uuid1',\n    result: 'script executed'\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = describeScriptFn.call(instanceStub, 'goto fail')\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, 'script executed')\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('describe_script', ['goto fail']))\n})\n\ntest('should send a web3Eth function request and observe the response', t => {\n  t.plan(2)\n  // arrange\n  const web3EthFn = Index.AppProxy.prototype.web3Eth\n  const observable = of({\n    id: 'uuid1',\n    result: ['accountA', 'accountB']\n  })\n  const instanceStub = {\n    rpc: {\n      // Mimic behaviour of @aragon/rpc-messenger\n      sendAndObserveResponse: createDeferredStub(observable)\n    }\n  }\n  // act\n  const result = web3EthFn.call(instanceStub, 'getAccounts', 5)\n  // assert\n  subscribe(result, value => {\n    t.deepEqual(value, ['accountA', 'accountB'])\n  })\n  t.true(instanceStub.rpc.sendAndObserveResponse.calledOnceWith('web3_eth', ['getAccounts', 5]))\n})\n"],"file":"index.test.js"}